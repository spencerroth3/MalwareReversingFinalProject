#include "commands.h"

BOOL ClientCommandGetInfo(struct Connection* conn)
{
	struct systemInfo info;
	getInformation(&info);
	return SendData(conn, CommandResponse, &info, sizeof(struct systemInfo));
}

BOOL ServerCommandGetInfo(struct Connection* conn)
{
	BOOL result = FALSE;
	if (SendData(conn, GetInformation, NULL, 0))
	{
		struct MainHeader * response = NULL;
		if (RecvData(conn, &response) && response->type == CommandResponse)
		{
			struct systemInfo* information = ((char*)response + sizeof(struct MainHeader));
			struct in_addr addr;
			addr.S_un.S_addr = information->ipAddr;
			char* ipaddr = inet_ntoa(addr);
			printf("IP Address: %s\n", ipaddr);
			printf("MAC Address: %.2x-%.2x-%.2x-%.2x-%.2x-%.2x\n", information->macAddr[0], information->macAddr[1], information->macAddr[2], information->macAddr[3], information->macAddr[4], information->macAddr[5]);
			printf("Current Username: %s\n", information->userName);
			printf("Current OS: ");
			switch (information->dwMajorVersion)
			{
			case 10:
				if (information->wProductType == VER_NT_WORKSTATION)
				{
					printf("Windows 10\n");
				}
				else
				{
					printf("Windows Server 2016\n");
				}
				break;
			case 6:
				switch (information->dwMinorVersion)
				{
				case 3:
					if (information->wProductType == VER_NT_WORKSTATION)
					{
						printf("Windows 8.1\n");
					}
					else
					{
						printf("Windows Server 2012 R2\n");
					}
					break;
				case 2:
					if (information->wProductType == VER_NT_WORKSTATION)
					{
						printf("Windows 8\n");
					}
					else
					{
						printf("Windows Server 2012\n");
					}
					break;
				case 1:
					if (information->wProductType == VER_NT_WORKSTATION)
					{
						printf("Windows 7\n");
					}
					else
					{
						printf("Windows Server 2008 R2\n");
					}
					break;
				case 0:
					if (information->wProductType == VER_NT_WORKSTATION)
					{
						printf("Windows Vista\n");
					}
					else
					{
						printf("Windows Server 2008\n");
					}
					break;
				default:
					printf("Unknown OS\n");
				}

				break;
			case 5:
				switch (information->dwMinorVersion)
				{
				case 2:
					printf("Windows Server 2003\n");
					break;
				case 1:
					printf("Windows XP\n");
					break;
				case 0:
					printf("Windows 2000\n");
					break;
				default:
					printf("Unknown OS\n");
				}
				break;
			default:
				printf("Unknown OS\n");
			}
			result = TRUE;
		}

		if (response)
		{
			HeapFree(GetProcessHeap(), 0, response);
		}
	}

	return result;
}

BOOL ServerCommandExecuteCommand(struct Connection* conn)
{
	return FALSE;
}

BOOL ClientCommandExecuteCommand(struct Connection* conn)
{
	return FALSE;
}

BOOL ServerCommandListProcesses(struct Connection* conn)
{
	return FALSE;
}

BOOL ClientCommandListProcesses(struct Connection* conn)
{
	return FALSE;
}

BOOL ServerCommandUploadFile(struct Connection* conn)
{
	return FALSE;
}

BOOL ClientCommandUploadFile(struct Connection * conn)
{
	return FALSE;
}

BOOL ServerCommandDownloadFile(struct Connection* conn)
{
	return FALSE;
}

BOOL ClientCommandDownloadFile(struct Connection* conn)
{
	return FALSE;
}